                    btn.disabled = questionData.answered;<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flag Guessing Game</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            position: relative;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .audio-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .mute-btn, .random-btn {
            background: #333;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .mute-btn:hover, .random-btn:hover {
            background: #555;
            transform: translateY(-2px);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-align: center;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Setup Area Styles */
        .setup-area {
            display: flex;
            flex-direction: column;
            gap: 25px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .setup-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .setup-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .mode-option {
            padding: 20px;
            border: 3px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            text-align: center;
        }
        
        .mode-option:hover {
            border-color: #007bff;
            background: #e7f3ff;
            transform: translateY(-2px);
        }
        
        .mode-option.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
            transform: translateY(-2px);
        }
        
        .mode-option h4 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .mode-option p {
            margin: 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .continent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .continent-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .continent-checkbox:hover {
            border-color: #007bff;
            background: #f0f8ff;
        }
        
        .continent-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .setup-section input[type="number"] {
            width: 120px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        /* Game Area Styles */
        .game-area {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 20px;
        }
        
        .question-info {
            font-size: 20px;
            color: #333;
            font-weight: 600;
            text-align: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }
        
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            flex: 1;
            min-height: 500px;
        }
        
        .game-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .map-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .flag-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #e9ecef;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .flag-display {
            width: 200px;
            height: 130px;
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            object-fit: cover;
        }
        
        .country-label {
            font-size: 26px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .capital-label {
            font-size: 18px;
            color: #666;
            font-style: italic;
        }
        
        .continent-info {
            font-size: 18px;
            color: #007bff;
            margin-top: 15px;
            font-weight: bold;
            background: #e7f3ff;
            padding: 8px 16px;
            border-radius: 8px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .option-btn {
            padding: 15px 20px;
            font-size: 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #007bff;
            color: white;
            font-weight: 600;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        /* Only apply hover effects on devices that support true hover */
        @media (hover: hover) and (pointer: fine) {
            .option-btn:hover:not(:disabled) {
                background: #0056b3;
                transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(0, 123, 255, 0.4);
            }
        }
        
        /* Ensure no hover effects on touch devices */
        @media (hover: none), (pointer: coarse) {
            .option-btn:hover {
                background: #007bff !important;
                transform: none !important;
                box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3) !important;
            }
        }
        
        .option-btn:focus {
            outline: none;
        }
        
        .option-btn:active {
            transform: translateY(-1px);
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
        }
        
        .option-btn.correct {
            background: #28a745;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }
        
        .option-btn.incorrect {
            background: #dc3545;
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
        }
        
        .capital-info {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 5px;
            font-style: italic;
        }
        
        .flag-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .flag-option {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 12px;
            border: 3px solid transparent;
            background: white;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        /* Only apply hover effects on devices that support true hover */
        @media (hover: hover) and (pointer: fine) {
            .flag-option:hover:not(.disabled) {
                transform: translateY(-3px);
                box-shadow: 0 6px 15px rgba(0,0,0,0.2);
                border-color: #007bff;
            }
        }
        
        /* Ensure no hover effects on touch devices */
        @media (hover: none), (pointer: coarse) {
            .flag-option:hover {
                transform: none !important;
                box-shadow: none !important;
                border-color: transparent !important;
            }
        }
        
        .flag-option:focus {
            outline: none;
        }
        
        .flag-option:active {
            transform: translateY(-1px);
        }
        
        .flag-option.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .flag-option.correct {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .flag-option.incorrect {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }
        
        .flag-option img {
            width: 100%;
            height: 80px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            object-fit: cover;
        }
        
        .flag-info {
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .flag-country-name {
            font-weight: bold;
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .flag-capital-name {
            font-size: 12px;
            color: #666;
            font-style: italic;
        }
        
        .map-container {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #4a90e2;
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 400px;
        }
        
        .map-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
            color: #495057;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .debug-info h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #333;
        }
        
        #map {
            width: 100%;
            flex: 1;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .score-info {
            font-size: 22px;
            color: #333;
            font-weight: bold;
            text-align: center;
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #007bff;
        }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .prev-btn {
            background: #6c757d;
            color: white;
            box-shadow: 0 4px 10px rgba(108, 117, 125, 0.3);
        }
        
        .prev-btn:hover:not(:disabled) {
            background: #5a6268;
            box-shadow: 0 6px 15px rgba(108, 117, 125, 0.4);
        }
        
        #next-btn {
            background: #28a745;
            color: white;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }
        
        #next-btn:hover:not(:disabled) {
            background: #218838;
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* Game Over Styles */
        .game-over {
            text-align: center;
            padding: 40px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            border: 3px solid #dee2e6;
        }
        
        .game-over h2 {
            font-size: 2.5em;
            margin-bottom: 25px;
            background: linear-gradient(45deg, #28a745, #20c997);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .final-score {
            font-size: 48px;
            color: #333;
            margin: 30px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .restart-btn {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            z-index: 10;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        
        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }
        
        .timer-warning {
            animation: pulse 1s infinite;
            color: #dc3545 !important;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Flag Animation Styles */
        .flag-animation {
            position: absolute;
            width: 60px;
            height: 40px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            animation: fallDown 4s linear infinite;
            opacity: 0;
        }
        
        @keyframes fallDown {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .mode-selection {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .continent-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .flag-display {
                width: 160px;
                height: 100px;
            }
            
            .flag-options {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nav-buttons {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .continent-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .flag-display {
                width: 120px;
                height: 80px;
            }
            
            .option-btn {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .final-score {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <audio id="backgroundMusic">
        <source id="bgSource" src="Flag_Game_1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <div class="game-container">
        <div class="audio-controls">
            <button class="random-btn" onclick="randomizeTrack()" id="randomBtn" title="Random Track">🎲</button>
            <button class="mute-btn" onclick="toggleMute()" id="muteBtn">🔊</button>
        </div>
        
        <h1>Ruben's Flag Guessing Game</h1>
        
        <div id="setup-area" class="setup-area">
            <div class="setup-section">
                <h3>Game Mode</h3>
                <div class="mode-selection">
                    <div class="mode-option selected" onclick="selectMode('nameFromFlag')" id="mode-nameFromFlag">
                        <h4>🏳️ Name from Flag</h4>
                        <p>See a flag and choose the correct country name</p>
                    </div>
                    <div class="mode-option" onclick="selectMode('flagFromName')" id="mode-flagFromName">
                        <h4>📍 Flag from Name</h4>
                        <p>See a country name and choose the correct flag</p>
                    </div>
                </div>
            </div>
            
            <div class="setup-section">
                <h3>Game Style</h3>
                <div class="mode-selection">
                    <div class="mode-option selected" onclick="selectStyle('standard')" id="style-standard">
                        <h4>📝 Standard</h4>
                        <p>Answer a set number of questions</p>
                    </div>
                    <div class="mode-option" onclick="selectStyle('timed')" id="style-timed">
                        <h4>⏱️ Timed</h4>
                        <p>Answer as many as you can in a time limit</p>
                    </div>
                </div>
            </div>
            
            <div class="setup-section" id="questions-section">
                <h3>Number of Questions</h3>
                <input type="number" id="questionCount" value="10" min="1" max="50">
            </div>
            
            <div class="setup-section" id="timer-section" style="display: none;">
                <h3>Time Limit (seconds)</h3>
                <input type="number" id="timeLimit" value="60" min="10" max="300" step="10">
            </div>
            
            <div class="setup-section">
                <h3>Select Continents</h3>
                <div class="continent-grid">
                    <label class="continent-checkbox">
                        <input type="checkbox" value="Africa" checked> Africa
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="Asia" checked> Asia
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="Europe" checked> Europe
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="North America" checked> North America
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="South America" checked> South America
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="Oceania" checked> Oceania
                    </label>
                    <label class="continent-checkbox">
                        <input type="checkbox" value="Antarctica" checked> Antarctica
                    </label>
                </div>
            </div>
            
            <div class="setup-section">
                <label class="continent-checkbox">
                    <input type="checkbox" id="sovereignOnly" checked> Sovereign states only
                </label>
            </div>
            
            <button class="start-btn" onclick="startGame()">🚀 Start Game</button>
        </div>
        
        <div id="game-area" class="game-area" style="display: none;">
            <div class="question-info">
                <span id="standard-info">
                    Question: <span id="question-number">1</span> / <span id="total-questions">10</span>
                </span>
                <span id="timed-info" style="display: none;">
                    Time: <span id="time-remaining">60</span>s | Questions: <span id="questions-answered">0</span>
                </span>
            </div>
            
            <div class="game-layout">
                <div class="game-column">
                    <div class="flag-container">
                        <div id="nameFromFlag-content">
                            <img id="flag-image" class="flag-display" src="" alt="Country Flag">
                            <div id="continent-info" class="continent-info" style="display: none;"></div>
                        </div>
                        
                        <div id="flagFromName-content" style="display: none;">
                            <div id="country-label" class="country-label"></div>
                            <div id="capital-label" class="capital-label"></div>
                        </div>
                    </div>
                    
                    <div id="text-options" class="options">
                        <button class="option-btn" onclick="selectOption(0)">Option 1</button>
                        <button class="option-btn" onclick="selectOption(1)">Option 2</button>
                        <button class="option-btn" onclick="selectOption(2)">Option 3</button>
                    </div>
                    
                    <div id="flag-options" class="flag-options" style="display: none;">
                        <div class="flag-option" onclick="selectFlagOption(0)">
                            <img src="" alt="Flag Option 1">
                            <div class="flag-info" style="display: none;">
                                <div class="flag-country-name"></div>
                                <div class="flag-capital-name"></div>
                            </div>
                        </div>
                        <div class="flag-option" onclick="selectFlagOption(1)">
                            <img src="" alt="Flag Option 2">
                            <div class="flag-info" style="display: none;">
                                <div class="flag-country-name"></div>
                                <div class="flag-capital-name"></div>
                            </div>
                        </div>
                        <div class="flag-option" onclick="selectFlagOption(2)">
                            <img src="" alt="Flag Option 3">
                            <div class="flag-info" style="display: none;">
                                <div class="flag-country-name"></div>
                                <div class="flag-capital-name"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="score-info">
                        Score: <span id="score">0</span>/<span id="total-questions-score">10</span>
                    </div>
                    
                    <div class="nav-buttons">
                        <button id="prev-btn" class="nav-btn prev-btn" onclick="previousQuestion()" disabled>← Previous</button>
                        <button id="next-btn" class="nav-btn" onclick="nextQuestion()" disabled>Next →</button>
                    </div>
                </div>
                
                <div class="map-column">
                    <div id="map-container" class="map-container">
                        <div class="map-title" id="map-title">🌍 World Map</div>
                        <div id="map"></div>
                    </div>
                    <button class="back-btn" onclick="backToSetup()">← Back to Setup</button>
                </div>
            </div>
        </div>
        
        <div id="game-over" class="game-over" style="display: none;">
            <h2>🎉 Game Complete!</h2>
            <div class="final-score">
                <span id="final-score">0</span> / <span id="total-score">10</span>
            </div>
            <button class="restart-btn" onclick="backToSetup()">🔄 Play Again</button>
        </div>
    </div>

    <script>
        // Country coordinates for map centering
        const countryCoordinates = {
            'ad': [42.5063, 1.5218], 'ae': [23.4241, 53.8478], 'af': [33.9391, 67.7100], 'ag': [17.0608, -61.7964],
            'al': [41.1533, 20.1683], 'am': [40.0691, 45.0382], 'ao': [-11.2027, 17.8739], 'ar': [-38.4161, -63.6167],
            'at': [47.5162, 14.5501], 'au': [-25.2744, 133.7751], 'az': [40.1431, 47.5769], 'ba': [43.9159, 17.6791],
            'bb': [13.1939, -59.5432], 'bd': [23.6850, 90.3563], 'be': [50.5039, 4.4699], 'bf': [12.2383, -1.5616],
            'bg': [42.7339, 25.4858], 'bh': [26.0667, 50.5577], 'bi': [-3.3731, 29.9189], 'bj': [9.3077, 2.3158],
            'bn': [4.5353, 114.7277], 'bo': [-16.2902, -63.5887], 'br': [-14.2350, -51.9253], 'bs': [25.0343, -77.3963],
            'bt': [27.5142, 90.4336], 'bw': [-22.3285, 24.6849], 'by': [53.7098, 27.9534], 'bz': [17.1899, -88.4976],
            'ca': [56.1304, -106.3468], 'cd': [-4.0383, 21.7587], 'cf': [6.6111, 20.9394], 'cg': [-0.2280, 15.8277],
            'ch': [46.8182, 8.2275], 'ci': [7.5400, -5.5471], 'cl': [-35.6751, -71.5430], 'cm': [7.3697, 12.3547],
            'cn': [35.8617, 104.1954], 'co': [4.5709, -74.2973], 'cr': [9.7489, -83.7534], 'cu': [21.5218, -77.7812],
            'cv': [16.0021, -24.0132], 'cy': [35.1264, 33.4299], 'cz': [49.8175, 15.4730], 'de': [51.1657, 10.4515],
            'dj': [11.8251, 42.5903], 'dk': [56.2639, 9.5018], 'dm': [15.4150, -61.3710], 'do': [18.7357, -70.1627],
            'dz': [28.0339, 1.6596], 'ec': [-1.8312, -78.1834], 'ee': [58.5953, 25.0136], 'eg': [26.8206, 30.8025],
            'er': [15.1794, 39.7823], 'es': [40.4637, -3.7492], 'et': [9.1450, 40.4897], 'fi': [61.9241, 25.7482],
            'fj': [-16.5782, 179.4144], 'fm': [7.4256, 150.5508], 'fr': [46.2276, 2.2137], 'ga': [-0.8037, 11.6094],
            'gb': [55.3781, -3.4360], 'gd': [12.2628, -61.6041], 'ge': [42.3154, 43.3569], 'gh': [7.9465, -1.0232],
            'gm': [13.4432, -15.3101], 'gn': [9.9456, -9.6966], 'gq': [1.6508, 10.2679], 'gr': [39.0742, 21.8243],
            'gt': [15.7835, -90.2308], 'gw': [11.8037, -15.1804], 'gy': [4.8604, -58.9302], 'hn': [15.2000, -86.2419],
            'hr': [45.1000, 15.2000], 'ht': [18.9712, -72.2852], 'hu': [47.1625, 19.5033], 'id': [-0.7893, 113.9213],
            'ie': [53.4129, -8.2439], 'il': [31.0461, 34.8516], 'in': [20.5937, 78.9629], 'iq': [33.2232, 43.6793],
            'ir': [32.4279, 53.6880], 'is': [64.9631, -19.0208], 'it': [41.8719, 12.5674], 'jm': [18.1096, -77.2975],
            'jo': [30.5852, 36.2384], 'jp': [36.2048, 138.2529], 'ke': [-0.0236, 37.9062], 'kg': [41.2044, 74.7661],
            'kh': [12.5657, 104.9910], 'ki': [1.8700, -157.3630], 'km': [-11.8750, 43.8722], 'kn': [17.3578, -62.7830],
            'kp': [40.3399, 127.5101], 'kr': [35.9078, 127.7669], 'kw': [29.3117, 47.4818], 'kz': [48.0196, 66.9237],
            'la': [19.8563, 102.4955], 'lb': [33.8547, 35.8623], 'lc': [13.9094, -60.9789], 'li': [47.1660, 9.5554],
            'lk': [7.8731, 80.7718], 'lr': [6.4281, -9.4295], 'ls': [-29.6100, 28.2336], 'lt': [55.1694, 23.8813],
            'lu': [49.8153, 6.1296], 'lv': [56.8796, 24.6032], 'ly': [26.3351, 17.2283], 'ma': [31.7917, -7.0926],
            'mc': [43.7384, 7.4246], 'md': [47.4116, 28.3699], 'me': [42.7087, 19.3744], 'mg': [-18.7669, 46.8691],
            'mh': [7.1315, 171.1845], 'mk': [41.6086, 21.7453], 'ml': [17.5707, -3.9962], 'mm': [21.9162, 95.9560],
            'mn': [46.8625, 103.8467], 'mr': [21.0079, -10.9408], 'mt': [35.9375, 14.3754], 'mu': [-20.3484, 57.5522],
            'mv': [3.2028, 73.2207], 'mw': [-13.2543, 34.3015], 'mx': [23.6345, -102.5528], 'my': [4.2105, 101.9758],
            'mz': [-18.6657, 35.5296], 'na': [-22.9576, 18.4904], 'ne': [17.6078, 8.0817], 'ng': [9.0820, 8.6753],
            'ni': [12.8654, -85.2072], 'nl': [52.1326, 5.2913], 'no': [60.4720, 8.4689], 'np': [28.3949, 84.1240],
            'nr': [-0.5228, 166.9315], 'nz': [-40.9006, 174.8860], 'om': [21.5126, 55.9233], 'pa': [8.5380, -80.7821],
            'pe': [-9.1900, -75.0152], 'pg': [-6.3150, 143.9555], 'ph': [12.8797, 121.7740], 'pk': [30.3753, 69.3451],
            'pl': [51.9194, 19.1451], 'pt': [39.3999, -8.2245], 'pw': [7.5150, 134.5825], 'py': [-23.4425, -58.4438],
            'qa': [25.3548, 51.1839], 'ro': [45.9432, 24.9668], 'rs': [44.0165, 21.0059], 'ru': [61.5240, 105.3188],
            'rw': [-1.9403, 29.8739], 'sa': [23.8859, 45.0792], 'sb': [-9.6457, 160.1562], 'sc': [-4.6796, 55.4920],
            'sd': [12.8628, 30.2176], 'se': [60.1282, 18.6435], 'sg': [1.3521, 103.8198], 'si': [46.1512, 14.9955],
            'sk': [48.6690, 19.6990], 'sl': [8.4606, -11.7799], 'sm': [43.9424, 12.4578], 'sn': [14.4974, -14.4524],
            'so': [5.1521, 46.1996], 'sr': [3.9193, -56.0278], 'ss': [6.8770, 31.3070], 'st': [0.1864, 6.6131],
            'sv': [13.7942, -88.8965], 'sy': [34.8021, 38.9968], 'sz': [-26.5225, 31.4659], 'td': [15.4542, 18.7322],
            'tg': [8.6195, 0.8248], 'th': [15.8700, 100.9925], 'tj': [38.8610, 71.2761], 'tl': [-8.8742, 125.7275],
            'tm': [38.9697, 59.5563], 'tn': [33.8869, 9.5375], 'to': [-21.1790, -175.1982], 'tr': [38.9637, 35.2433],
            'tt': [10.6918, -61.2225], 'tv': [-7.1095, 177.6493], 'tw': [23.6978, 120.9605], 'tz': [-6.3690, 34.8888],
            'ua': [48.3794, 31.1656], 'ug': [1.3733, 32.2903], 'us': [37.0902, -95.7129], 'uy': [-32.5228, -55.7658],
            'uz': [41.3775, 64.5853], 'va': [41.9029, 12.4534], 'vc': [12.9843, -61.2872], 've': [6.4238, -66.5897],
            'vn': [14.0583, 108.2772], 'vu': [-15.3767, 166.9592], 'ws': [-13.7590, -172.1046], 'ye': [15.5527, 48.5164],
            'za': [-30.5595, 22.9375], 'zm': [-13.1339, 27.8493], 'zw': [-19.0154, 29.1549]
        };

        const allCountries = [
            {code: 'ad', name: 'Andorra', capital: 'Andorra la Vella', continent: 'Europe', sovereign: true},
            {code: 'ae', name: 'United Arab Emirates', capital: 'Abu Dhabi', continent: 'Asia', sovereign: true},
            {code: 'af', name: 'Afghanistan', capital: 'Kabul', continent: 'Asia', sovereign: true},
            {code: 'ag', name: 'Antigua and Barbuda', capital: 'Saint John\'s', continent: 'North America', sovereign: true},
            {code: 'al', name: 'Albania', capital: 'Tirana', continent: 'Europe', sovereign: true},
            {code: 'am', name: 'Armenia', capital: 'Yerevan', continent: 'Asia', sovereign: true},
            {code: 'ao', name: 'Angola', capital: 'Luanda', continent: 'Africa', sovereign: true},
            {code: 'ar', name: 'Argentina', capital: 'Buenos Aires', continent: 'South America', sovereign: true},
            {code: 'at', name: 'Austria', capital: 'Vienna', continent: 'Europe', sovereign: true},
            {code: 'au', name: 'Australia', capital: 'Canberra', continent: 'Oceania', sovereign: true},
            {code: 'az', name: 'Azerbaijan', capital: 'Baku', continent: 'Asia', sovereign: true},
            {code: 'ba', name: 'Bosnia and Herzegovina', capital: 'Sarajevo', continent: 'Europe', sovereign: true},
            {code: 'bb', name: 'Barbados', capital: 'Bridgetown', continent: 'North America', sovereign: true},
            {code: 'bd', name: 'Bangladesh', capital: 'Dhaka', continent: 'Asia', sovereign: true},
            {code: 'be', name: 'Belgium', capital: 'Brussels', continent: 'Europe', sovereign: true},
            {code: 'bf', name: 'Burkina Faso', capital: 'Ouagadougou', continent: 'Africa', sovereign: true},
            {code: 'bg', name: 'Bulgaria', capital: 'Sofia', continent: 'Europe', sovereign: true},
            {code: 'bh', name: 'Bahrain', capital: 'Manama', continent: 'Asia', sovereign: true},
            {code: 'bi', name: 'Burundi', capital: 'Gitega', continent: 'Africa', sovereign: true},
            {code: 'bj', name: 'Benin', capital: 'Porto-Novo', continent: 'Africa', sovereign: true},
            {code: 'bn', name: 'Brunei', capital: 'Bandar Seri Begawan', continent: 'Asia', sovereign: true},
            {code: 'bo', name: 'Bolivia', capital: 'Sucre', continent: 'South America', sovereign: true},
            {code: 'br', name: 'Brazil', capital: 'Brasília', continent: 'South America', sovereign: true},
            {code: 'bs', name: 'Bahamas', capital: 'Nassau', continent: 'North America', sovereign: true},
            {code: 'bt', name: 'Bhutan', capital: 'Thimphu', continent: 'Asia', sovereign: true},
            {code: 'bw', name: 'Botswana', capital: 'Gaborone', continent: 'Africa', sovereign: true},
            {code: 'by', name: 'Belarus', capital: 'Minsk', continent: 'Europe', sovereign: true},
            {code: 'bz', name: 'Belize', capital: 'Belmopan', continent: 'North America', sovereign: true},
            {code: 'ca', name: 'Canada', capital: 'Ottawa', continent: 'North America', sovereign: true},
            {code: 'cd', name: 'Democratic Republic of the Congo', capital: 'Kinshasa', continent: 'Africa', sovereign: true},
            {code: 'cf', name: 'Central African Republic', capital: 'Bangui', continent: 'Africa', sovereign: true},
            {code: 'cg', name: 'Republic of the Congo', capital: 'Brazzaville', continent: 'Africa', sovereign: true},
            {code: 'ch', name: 'Switzerland', capital: 'Bern', continent: 'Europe', sovereign: true},
            {code: 'ci', name: 'Ivory Coast', capital: 'Yamoussoukro', continent: 'Africa', sovereign: true},
            {code: 'cl', name: 'Chile', capital: 'Santiago', continent: 'South America', sovereign: true},
            {code: 'cm', name: 'Cameroon', capital: 'Yaoundé', continent: 'Africa', sovereign: true},
            {code: 'cn', name: 'China', capital: 'Beijing', continent: 'Asia', sovereign: true},
            {code: 'co', name: 'Colombia', capital: 'Bogotá', continent: 'South America', sovereign: true},
            {code: 'cr', name: 'Costa Rica', capital: 'San José', continent: 'North America', sovereign: true},
            {code: 'cu', name: 'Cuba', capital: 'Havana', continent: 'North America', sovereign: true},
            {code: 'cv', name: 'Cape Verde', capital: 'Praia', continent: 'Africa', sovereign: true},
            {code: 'cy', name: 'Cyprus', capital: 'Nicosia', continent: 'Europe', sovereign: true},
            {code: 'cz', name: 'Czech Republic', capital: 'Prague', continent: 'Europe', sovereign: true},
            {code: 'de', name: 'Germany', capital: 'Berlin', continent: 'Europe', sovereign: true},
            {code: 'dj', name: 'Djibouti', capital: 'Djibouti City', continent: 'Africa', sovereign: true},
            {code: 'dk', name: 'Denmark', capital: 'Copenhagen', continent: 'Europe', sovereign: true},
            {code: 'dm', name: 'Dominica', capital: 'Roseau', continent: 'North America', sovereign: true},
            {code: 'do', name: 'Dominican Republic', capital: 'Santo Domingo', continent: 'North America', sovereign: true},
            {code: 'dz', name: 'Algeria', capital: 'Algiers', continent: 'Africa', sovereign: true},
            {code: 'ec', name: 'Ecuador', capital: 'Quito', continent: 'South America', sovereign: true},
            {code: 'ee', name: 'Estonia', capital: 'Tallinn', continent: 'Europe', sovereign: true},
            {code: 'eg', name: 'Egypt', capital: 'Cairo', continent: 'Africa', sovereign: true},
            {code: 'er', name: 'Eritrea', capital: 'Asmara', continent: 'Africa', sovereign: true},
            {code: 'es', name: 'Spain', capital: 'Madrid', continent: 'Europe', sovereign: true},
            {code: 'et', name: 'Ethiopia', capital: 'Addis Ababa', continent: 'Africa', sovereign: true},
            {code: 'fi', name: 'Finland', capital: 'Helsinki', continent: 'Europe', sovereign: true},
            {code: 'fj', name: 'Fiji', capital: 'Suva', continent: 'Oceania', sovereign: true},
            {code: 'fm', name: 'Micronesia', capital: 'Palikir', continent: 'Oceania', sovereign: true},
            {code: 'fr', name: 'France', capital: 'Paris', continent: 'Europe', sovereign: true},
            {code: 'ga', name: 'Gabon', capital: 'Libreville', continent: 'Africa', sovereign: true},
            {code: 'gb', name: 'United Kingdom', capital: 'London', continent: 'Europe', sovereign: true},
            {code: 'gd', name: 'Grenada', capital: 'Saint George\'s', continent: 'North America', sovereign: true},
            {code: 'ge', name: 'Georgia', capital: 'Tbilisi', continent: 'Asia', sovereign: true},
            {code: 'gh', name: 'Ghana', capital: 'Accra', continent: 'Africa', sovereign: true},
            {code: 'gm', name: 'Gambia', capital: 'Banjul', continent: 'Africa', sovereign: true},
            {code: 'gn', name: 'Guinea', capital: 'Conakry', continent: 'Africa', sovereign: true},
            {code: 'gq', name: 'Equatorial Guinea', capital: 'Malabo', continent: 'Africa', sovereign: true},
            {code: 'gr', name: 'Greece', capital: 'Athens', continent: 'Europe', sovereign: true},
            {code: 'gt', name: 'Guatemala', capital: 'Guatemala City', continent: 'North America', sovereign: true},
            {code: 'gw', name: 'Guinea-Bissau', capital: 'Bissau', continent: 'Africa', sovereign: true},
            {code: 'gy', name: 'Guyana', capital: 'Georgetown', continent: 'South America', sovereign: true},
            {code: 'hn', name: 'Honduras', capital: 'Tegucigalpa', continent: 'North America', sovereign: true},
            {code: 'hr', name: 'Croatia', capital: 'Zagreb', continent: 'Europe', sovereign: true},
            {code: 'ht', name: 'Haiti', capital: 'Port-au-Prince', continent: 'North America', sovereign: true},
            {code: 'hu', name: 'Hungary', capital: 'Budapest', continent: 'Europe', sovereign: true},
            {code: 'id', name: 'Indonesia', capital: 'Jakarta', continent: 'Asia', sovereign: true},
            {code: 'ie', name: 'Ireland', capital: 'Dublin', continent: 'Europe', sovereign: true},
            {code: 'il', name: 'Israel', capital: 'Jerusalem', continent: 'Asia', sovereign: true},
            {code: 'in', name: 'India', capital: 'New Delhi', continent: 'Asia', sovereign: true},
            {code: 'iq', name: 'Iraq', capital: 'Baghdad', continent: 'Asia', sovereign: true},
            {code: 'ir', name: 'Iran', capital: 'Tehran', continent: 'Asia', sovereign: true},
            {code: 'is', name: 'Iceland', capital: 'Reykjavik', continent: 'Europe', sovereign: true},
            {code: 'it', name: 'Italy', capital: 'Rome', continent: 'Europe', sovereign: true},
            {code: 'jm', name: 'Jamaica', capital: 'Kingston', continent: 'North America', sovereign: true},
            {code: 'jo', name: 'Jordan', capital: 'Amman', continent: 'Asia', sovereign: true},
            {code: 'jp', name: 'Japan', capital: 'Tokyo', continent: 'Asia', sovereign: true},
            {code: 'ke', name: 'Kenya', capital: 'Nairobi', continent: 'Africa', sovereign: true},
            {code: 'kg', name: 'Kyrgyzstan', capital: 'Bishkek', continent: 'Asia', sovereign: true},
            {code: 'kh', name: 'Cambodia', capital: 'Phnom Penh', continent: 'Asia', sovereign: true},
            {code: 'ki', name: 'Kiribati', capital: 'Tarawa', continent: 'Oceania', sovereign: true},
            {code: 'km', name: 'Comoros', capital: 'Moroni', continent: 'Africa', sovereign: true},
            {code: 'kn', name: 'Saint Kitts and Nevis', capital: 'Basseterre', continent: 'North America', sovereign: true},
            {code: 'kp', name: 'North Korea', capital: 'Pyongyang', continent: 'Asia', sovereign: true},
            {code: 'kr', name: 'South Korea', capital: 'Seoul', continent: 'Asia', sovereign: true},
            {code: 'kw', name: 'Kuwait', capital: 'Kuwait City', continent: 'Asia', sovereign: true},
            {code: 'kz', name: 'Kazakhstan', capital: 'Nur-Sultan', continent: 'Asia', sovereign: true},
            {code: 'la', name: 'Laos', capital: 'Vientiane', continent: 'Asia', sovereign: true},
            {code: 'lb', name: 'Lebanon', capital: 'Beirut', continent: 'Asia', sovereign: true},
            {code: 'lc', name: 'Saint Lucia', capital: 'Castries', continent: 'North America', sovereign: true},
            {code: 'li', name: 'Liechtenstein', capital: 'Vaduz', continent: 'Europe', sovereign: true},
            {code: 'lk', name: 'Sri Lanka', capital: 'Colombo', continent: 'Asia', sovereign: true},
            {code: 'lr', name: 'Liberia', capital: 'Monrovia', continent: 'Africa', sovereign: true},
            {code: 'ls', name: 'Lesotho', capital: 'Maseru', continent: 'Africa', sovereign: true},
            {code: 'lt', name: 'Lithuania', capital: 'Vilnius', continent: 'Europe', sovereign: true},
            {code: 'lu', name: 'Luxembourg', capital: 'Luxembourg City', continent: 'Europe', sovereign: true},
            {code: 'lv', name: 'Latvia', capital: 'Riga', continent: 'Europe', sovereign: true},
            {code: 'ly', name: 'Libya', capital: 'Tripoli', continent: 'Africa', sovereign: true},
            {code: 'ma', name: 'Morocco', capital: 'Rabat', continent: 'Africa', sovereign: true},
            {code: 'mc', name: 'Monaco', capital: 'Monaco', continent: 'Europe', sovereign: true},
            {code: 'md', name: 'Moldova', capital: 'Chișinău', continent: 'Europe', sovereign: true},
            {code: 'me', name: 'Montenegro', capital: 'Podgorica', continent: 'Europe', sovereign: true},
            {code: 'mg', name: 'Madagascar', capital: 'Antananarivo', continent: 'Africa', sovereign: true},
            {code: 'mh', name: 'Marshall Islands', capital: 'Majuro', continent: 'Oceania', sovereign: true},
            {code: 'mk', name: 'North Macedonia', capital: 'Skopje', continent: 'Europe', sovereign: true},
            {code: 'ml', name: 'Mali', capital: 'Bamako', continent: 'Africa', sovereign: true},
            {code: 'mm', name: 'Myanmar', capital: 'Naypyidaw', continent: 'Asia', sovereign: true},
            {code: 'mn', name: 'Mongolia', capital: 'Ulaanbaatar', continent: 'Asia', sovereign: true},
            {code: 'mr', name: 'Mauritania', capital: 'Nouakchott', continent: 'Africa', sovereign: true},
            {code: 'mt', name: 'Malta', capital: 'Valletta', continent: 'Europe', sovereign: true},
            {code: 'mu', name: 'Mauritius', capital: 'Port Louis', continent: 'Africa', sovereign: true},
            {code: 'mv', name: 'Maldives', capital: 'Malé', continent: 'Asia', sovereign: true},
            {code: 'mw', name: 'Malawi', capital: 'Lilongwe', continent: 'Africa', sovereign: true},
            {code: 'mx', name: 'Mexico', capital: 'Mexico City', continent: 'North America', sovereign: true},
            {code: 'my', name: 'Malaysia', capital: 'Kuala Lumpur', continent: 'Asia', sovereign: true},
            {code: 'mz', name: 'Mozambique', capital: 'Maputo', continent: 'Africa', sovereign: true},
            {code: 'na', name: 'Namibia', capital: 'Windhoek', continent: 'Africa', sovereign: true},
            {code: 'ne', name: 'Niger', capital: 'Niamey', continent: 'Africa', sovereign: true},
            {code: 'ng', name: 'Nigeria', capital: 'Abuja', continent: 'Africa', sovereign: true},
            {code: 'ni', name: 'Nicaragua', capital: 'Managua', continent: 'North America', sovereign: true},
            {code: 'nl', name: 'Netherlands', capital: 'Amsterdam', continent: 'Europe', sovereign: true},
            {code: 'no', name: 'Norway', capital: 'Oslo', continent: 'Europe', sovereign: true},
            {code: 'np', name: 'Nepal', capital: 'Kathmandu', continent: 'Asia', sovereign: true},
            {code: 'nr', name: 'Nauru', capital: 'Yaren', continent: 'Oceania', sovereign: true},
            {code: 'nz', name: 'New Zealand', capital: 'Wellington', continent: 'Oceania', sovereign: true},
            {code: 'om', name: 'Oman', capital: 'Muscat', continent: 'Asia', sovereign: true},
            {code: 'pa', name: 'Panama', capital: 'Panama City', continent: 'North America', sovereign: true},
            {code: 'pe', name: 'Peru', capital: 'Lima', continent: 'South America', sovereign: true},
            {code: 'pg', name: 'Papua New Guinea', capital: 'Port Moresby', continent: 'Oceania', sovereign: true},
            {code: 'ph', name: 'Philippines', capital: 'Manila', continent: 'Asia', sovereign: true},
            {code: 'pk', name: 'Pakistan', capital: 'Islamabad', continent: 'Asia', sovereign: true},
            {code: 'pl', name: 'Poland', capital: 'Warsaw', continent: 'Europe', sovereign: true},
            {code: 'pt', name: 'Portugal', capital: 'Lisbon', continent: 'Europe', sovereign: true},
            {code: 'pw', name: 'Palau', capital: 'Ngerulmud', continent: 'Oceania', sovereign: true},
            {code: 'py', name: 'Paraguay', capital: 'Asunción', continent: 'South America', sovereign: true},
            {code: 'qa', name: 'Qatar', capital: 'Doha', continent: 'Asia', sovereign: true},
            {code: 'ro', name: 'Romania', capital: 'Bucharest', continent: 'Europe', sovereign: true},
            {code: 'rs', name: 'Serbia', capital: 'Belgrade', continent: 'Europe', sovereign: true},
            {code: 'ru', name: 'Russia', capital: 'Moscow', continent: 'Europe', sovereign: true},
            {code: 'rw', name: 'Rwanda', capital: 'Kigali', continent: 'Africa', sovereign: true},
            {code: 'sa', name: 'Saudi Arabia', capital: 'Riyadh', continent: 'Asia', sovereign: true},
            {code: 'sb', name: 'Solomon Islands', capital: 'Honiara', continent: 'Oceania', sovereign: true},
            {code: 'sc', name: 'Seychelles', capital: 'Victoria', continent: 'Africa', sovereign: true},
            {code: 'sd', name: 'Sudan', capital: 'Khartoum', continent: 'Africa', sovereign: true},
            {code: 'se', name: 'Sweden', capital: 'Stockholm', continent: 'Europe', sovereign: true},
            {code: 'sg', name: 'Singapore', capital: 'Singapore', continent: 'Asia', sovereign: true},
            {code: 'si', name: 'Slovenia', capital: 'Ljubljana', continent: 'Europe', sovereign: true},
            {code: 'sk', name: 'Slovakia', capital: 'Bratislava', continent: 'Europe', sovereign: true},
            {code: 'sl', name: 'Sierra Leone', capital: 'Freetown', continent: 'Africa', sovereign: true},
            {code: 'sm', name: 'San Marino', capital: 'San Marino', continent: 'Europe', sovereign: true},
            {code: 'sn', name: 'Senegal', capital: 'Dakar', continent: 'Africa', sovereign: true},
            {code: 'so', name: 'Somalia', capital: 'Mogadishu', continent: 'Africa', sovereign: true},
            {code: 'sr', name: 'Suriname', capital: 'Paramaribo', continent: 'South America', sovereign: true},
            {code: 'ss', name: 'South Sudan', capital: 'Juba', continent: 'Africa', sovereign: true},
            {code: 'st', name: 'São Tomé and Príncipe', capital: 'São Tomé', continent: 'Africa', sovereign: true},
            {code: 'sv', name: 'El Salvador', capital: 'San Salvador', continent: 'North America', sovereign: true},
            {code: 'sy', name: 'Syria', capital: 'Damascus', continent: 'Asia', sovereign: true},
            {code: 'sz', name: 'Eswatini', capital: 'Mbabane', continent: 'Africa', sovereign: true},
            {code: 'td', name: 'Chad', capital: 'N\'Djamena', continent: 'Africa', sovereign: true},
            {code: 'tg', name: 'Togo', capital: 'Lomé', continent: 'Africa', sovereign: true},
            {code: 'th', name: 'Thailand', capital: 'Bangkok', continent: 'Asia', sovereign: true},
            {code: 'tj', name: 'Tajikistan', capital: 'Dushanbe', continent: 'Asia', sovereign: true},
            {code: 'tl', name: 'East Timor', capital: 'Dili', continent: 'Asia', sovereign: true},
            {code: 'tm', name: 'Turkmenistan', capital: 'Ashgabat', continent: 'Asia', sovereign: true},
            {code: 'tn', name: 'Tunisia', capital: 'Tunis', continent: 'Africa', sovereign: true},
            {code: 'to', name: 'Tonga', capital: 'Nuku\'alofa', continent: 'Oceania', sovereign: true},
            {code: 'tr', name: 'Turkey', capital: 'Ankara', continent: 'Asia', sovereign: true},
            {code: 'tt', name: 'Trinidad and Tobago', capital: 'Port of Spain', continent: 'North America', sovereign: true},
            {code: 'tv', name: 'Tuvalu', capital: 'Funafuti', continent: 'Oceania', sovereign: true},
            {code: 'tw', name: 'Taiwan', capital: 'Taipei', continent: 'Asia', sovereign: false},
            {code: 'tz', name: 'Tanzania', capital: 'Dodoma', continent: 'Africa', sovereign: true},
            {code: 'ua', name: 'Ukraine', capital: 'Kyiv', continent: 'Europe', sovereign: true},
            {code: 'ug', name: 'Uganda', capital: 'Kampala', continent: 'Africa', sovereign: true},
            {code: 'us', name: 'United States', capital: 'Washington, D.C.', continent: 'North America', sovereign: true},
            {code: 'uy', name: 'Uruguay', capital: 'Montevideo', continent: 'South America', sovereign: true},
            {code: 'uz', name: 'Uzbekistan', capital: 'Tashkent', continent: 'Asia', sovereign: true},
            {code: 'va', name: 'Vatican City', capital: 'Vatican City', continent: 'Europe', sovereign: true},
            {code: 'vc', name: 'Saint Vincent and the Grenadines', capital: 'Kingstown', continent: 'North America', sovereign: true},
            {code: 've', name: 'Venezuela', capital: 'Caracas', continent: 'South America', sovereign: true},
            {code: 'vn', name: 'Vietnam', capital: 'Hanoi', continent: 'Asia', sovereign: true},
            {code: 'vu', name: 'Vanuatu', capital: 'Port Vila', continent: 'Oceania', sovereign: true},
            {code: 'ws', name: 'Samoa', capital: 'Apia', continent: 'Oceania', sovereign: true},
            {code: 'ye', name: 'Yemen', capital: 'Sana\'a', continent: 'Asia', sovereign: true},
            {code: 'za', name: 'South Africa', capital: 'Cape Town', continent: 'Africa', sovereign: true},
            {code: 'zm', name: 'Zambia', capital: 'Lusaka', continent: 'Africa', sovereign: true},
            {code: 'zw', name: 'Zimbabwe', capital: 'Harare', continent: 'Africa', sovereign: true}
        ];

        let currentQuestion = 0;
        let score = 0;
        let totalQuestions = 10;
        let gameData = [];
        let selectedAnswer = null;
        let correctAnswer = null;
        let countries = [];
        let isMuted = false;
        let correctAnswers = 0;
        let map = null;
        let currentMarker = null;
        let countryLayer = null;
        let gameMode = 'nameFromFlag';
        let gameStyle = 'standard';
        let timeLimit = 60;
        let timeRemaining = 60;
        let timerInterval = null;
        let questionsAnsweredInTime = 0;

        // Music system
        const tracks = [
            'Flag_Game_1.mp3',
            'Flag_Game_2.mp3', 
            'Flag_Game_3.mp3',
            'Flag_Game_4.mp3',
            'Flag_Game_5.mp3',
            'Flag_Game_6.mp3',
            'Flag_Game_7.mp3',
            'Flag_Game_8.mp3'
        ];
        let currentTrack = Math.floor(Math.random() * tracks.length);
        let musicPlaying = false;

        console.log(`🎵 Initial random track selected: ${currentTrack + 1} (${tracks[currentTrack]})`);

        function loadTrack() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            const bgSource = document.getElementById('bgSource');
            
            bgSource.src = tracks[currentTrack];
            backgroundMusic.load();
            
            console.log(`🎵 Loading track: ${currentTrack + 1} (${tracks[currentTrack]})`);
            
            if (musicPlaying && !isMuted) {
                backgroundMusic.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        function randomizeTrack() {
            const oldTrack = currentTrack;
            // Pick a random track that isn't the current one
            do {
                currentTrack = Math.floor(Math.random() * tracks.length);
            } while (currentTrack === oldTrack && tracks.length > 1);
            
            console.log(`🎲 Randomized from track ${oldTrack + 1} to track ${currentTrack + 1}`);
            loadTrack();
        }

        function setupMusicSystem() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            // When a track ends, move to the next one in sequence
            backgroundMusic.addEventListener('ended', () => {
                currentTrack = (currentTrack + 1) % tracks.length;
                console.log(`🎵 Track ended, advancing to track ${currentTrack + 1}`);
                loadTrack();
            });
            
            // Handle audio errors
            backgroundMusic.addEventListener('error', (e) => {
                console.log('Audio error:', e);
                // Try next track if current one fails
                currentTrack = (currentTrack + 1) % tracks.length;
                setTimeout(loadTrack, 1000);
            });
            
            // Load the initial random track
            loadTrack();
        }

        function startMusic() {
            if (!isMuted) {
                const music = document.getElementById('backgroundMusic');
                musicPlaying = true;
                music.play().catch(e => {
                    console.log('Audio autoplay prevented:', e);
                    // Show a user-friendly message that they can click the mute button to enable audio
                });
            }
        }

        function stopMusic() {
            const music = document.getElementById('backgroundMusic');
            musicPlaying = false;
            music.pause();
            music.currentTime = 0;
        }

        function selectMode(mode) {
            gameMode = mode;
            // Only clear mode options, not style options
            document.querySelectorAll('[id^="mode-"]').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(`mode-${mode}`).classList.add('selected');
        }

        function selectStyle(style) {
            gameStyle = style;
            
            // Remove selected class from all style options
            document.querySelectorAll('[id^="style-"]').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to the chosen style
            const selectedElement = document.getElementById(`style-${style}`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            // Show/hide relevant sections
            document.getElementById('timer-section').style.display = style === 'timed' ? 'block' : 'none';
            document.getElementById('questions-section').style.display = style === 'standard' ? 'block' : 'none';
        }

        function initMap() {
            if (!map) {
                map = L.map('map').setView([20, 0], 2);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    subdomains: 'abcd',
                    attribution: '&copy; <a href="https://carto.com/">CARTO</a> contributors',
                    maxZoom: 18
                }).addTo(map);
            }
        }

        function debugLog(message) {
            const debugDiv = document.getElementById('debug-log');
            const debugInfo = document.getElementById('debug-info');
            
            if (debugDiv && debugInfo) {
                debugInfo.style.display = 'block';
                debugDiv.innerHTML += message + '<br>';
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
            console.log(message); // Also log to console for backup
        }

        function clearDebugLog() {
            const debugDiv = document.getElementById('debug-log');
            const debugInfo = document.getElementById('debug-info');
            
            if (debugDiv) {
                debugDiv.innerHTML = '';
            }
            if (debugInfo) {
                debugInfo.style.display = 'none';
            }
        }

        function ringArea(coords) {
            let area = 0;
            for (let i = 0, len = coords.length, j = len - 1; i < len; j = i++) {
                const xi = coords[i][0], yi = coords[i][1];
                const xj = coords[j][0], yj = coords[j][1];
                area += (xj * yi - xi * yj);
            }
            return Math.abs(area) / 2;
        }

        function showWorldMap() {
            if (!map) initMap();
            
            const mapTitle = document.getElementById('map-title');
            mapTitle.textContent = '🌍 World Map';
            
            if (currentMarker) {
                map.removeLayer(currentMarker);
                currentMarker = null;
            }
            if (countryLayer) {
                map.removeLayer(countryLayer);
                countryLayer = null;
            }
            
            map.setView([20, 0], 2);
        }

        function showCountryMap(countryCode, countryName) {
            if (!map) initMap();
            const mapTitle = document.getElementById('map-title');
            mapTitle.textContent = `📍 ${countryName}`;

            if (currentMarker) map.removeLayer(currentMarker);
            if (countryLayer) map.removeLayer(countryLayer);

            const coords = countryCoordinates[countryCode];
            if (!coords) return;

            currentMarker = L.marker(coords)
                .addTo(map)
                .bindPopup(`<b>${countryName}</b>`)
                .openPopup();

            let zoom = 5;
            if (['us','ca','ru','cn','br','au','in'].includes(countryCode)) zoom = 3;
            if (['va','mc','sm','li','ad'].includes(countryCode)) zoom = 10;
            map.setView(coords, zoom);

            // Fetch and display country boundary
            const apiUrl = `https://nominatim.openstreetmap.org/search?country=${encodeURIComponent(countryName)}&format=json&limit=1&polygon_geojson=1`;
            
            fetch(apiUrl)
                .then(r => r.json())
                .then(data => {
                    if (!data || data.length === 0 || !data[0] || !data[0].geojson) return;
                    
                    let gj = data[0].geojson;

                    if (gj.type === 'MultiPolygon') {
                        let best = { area: 0, coords: null };
                        gj.coordinates.forEach(polygon => {
                            const area = ringArea(polygon[0]);
                            if (area > best.area) best = { area, coords: polygon };
                        });
                        gj = { type: 'Polygon', coordinates: best.coords };
                    }

                    countryLayer = L.geoJSON(gj, {
                        style: {
                            color: '#ff0000',
                            weight: 3,
                            opacity: 0.8,
                            fillColor: '#ff0000',
                            fillOpacity: 0.2
                        }
                    }).addTo(map);
                })
                .catch(err => console.warn('Boundary load failed:', err));
        }

        function getSelectedContinents() {
            const checkboxes = document.querySelectorAll('.continent-checkbox input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function filterCountries() {
            const selectedContinents = getSelectedContinents();
            const sovereignOnly = document.getElementById('sovereignOnly').checked;
            
            countries = allCountries.filter(country => {
                const continentMatch = selectedContinents.includes(country.continent);
                const sovereignMatch = sovereignOnly ? country.sovereign : true;
                return continentMatch && sovereignMatch;
            });
        }

        function createFlagAnimation() {
            const gameOverDiv = document.getElementById('game-over');
            const flagsToAnimate = [
                'us', 'gb', 'fr', 'de', 'it', 'es', 'ca', 'au', 'jp', 'cn', 'br', 'in', 'mx', 'za', 'eg', 'ng', 'ar', 'ru', 'kr', 'th',
                'nl', 'se', 'no', 'dk', 'fi', 'ch', 'at', 'be', 'pl', 'tr', 'gr', 'pt', 'ie', 'nz', 'sg', 'my', 'ph', 'id', 'vn', 'bd'
            ];
            
            const existingFlags = gameOverDiv.querySelectorAll('.flag-animation');
            existingFlags.forEach(flag => flag.remove());
            
            for (let i = 0; i < 10; i++) {
                const flagImg = document.createElement('img');
                flagImg.className = 'flag-animation';
                flagImg.src = `https://flagcdn.com/w160/${flagsToAnimate[Math.floor(Math.random() * flagsToAnimate.length)]}.png`;
                flagImg.style.left = Math.random() * 95 + '%';
                flagImg.style.top = '-100px';
                flagImg.style.animationDelay = (i * 0.3) + 's';
                gameOverDiv.appendChild(flagImg);
            }
        }

        function startGame() {
            filterCountries();
            
            if (countries.length < 3) {
                alert('Please select more continents or uncheck "Sovereign states only" to have enough countries for the game.');
                return;
            }
            
            if (gameStyle === 'standard') {
                totalQuestions = parseInt(document.getElementById('questionCount').value);
                
                if (totalQuestions > countries.length) {
                    alert(`Not enough countries selected. Maximum questions: ${countries.length}`);
                    return;
                }
            } else {
                timeLimit = parseInt(document.getElementById('timeLimit').value);
                timeRemaining = timeLimit;
                totalQuestions = Math.min(countries.length, 50); // Limit for performance
                questionsAnsweredInTime = 0;
            }
            
            document.getElementById('setup-area').style.display = 'none';
            document.getElementById('game-area').style.display = 'block';
            
            // Show appropriate info based on game style
            document.getElementById('standard-info').style.display = gameStyle === 'standard' ? 'inline' : 'none';
            document.getElementById('timed-info').style.display = gameStyle === 'timed' ? 'inline' : 'none';
            
            // Start the music
            startMusic();
            
            initializeGame();
            
            if (gameStyle === 'timed') {
                startTimer();
            }
        }

        function startTimer() {
            document.getElementById('time-remaining').textContent = timeRemaining;
            timerInterval = setInterval(() => {
                timeRemaining--;
                document.getElementById('time-remaining').textContent = timeRemaining;
                
                // Add warning effect when time is low
                if (timeRemaining <= 10) {
                    document.getElementById('time-remaining').parentElement.classList.add('timer-warning');
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function backToSetup() {
            document.getElementById('setup-area').style.display = 'block';
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            
            // Stop the music
            stopMusic();
            
            // Clear timer if running
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Clear auto-advance timeout if running
            if (autoAdvanceTimeout) {
                clearTimeout(autoAdvanceTimeout);
                autoAdvanceTimeout = null;
            }
            
            // Reset timer warning
            document.getElementById('time-remaining')?.parentElement?.classList.remove('timer-warning');
            
            // Reset variables
            currentQuestion = 0;
            score = 0;
            correctAnswers = 0;
            timeRemaining = timeLimit;
            questionsAnsweredInTime = 0;
        }

        function toggleMute() {
            const music = document.getElementById('backgroundMusic');
            const muteBtn = document.getElementById('muteBtn');
            
            if (isMuted) {
                music.muted = false;
                muteBtn.textContent = '🔊';
                isMuted = false;
                if (musicPlaying) {
                    music.play().catch(e => console.log('Audio play failed'));
                }
            } else {
                music.muted = true;
                muteBtn.textContent = '🔇';
                isMuted = true;
            }
        }

        function initializeGame() {
            gameData = [];
            
            // Create a shuffled copy of countries for this game
            const shuffledCountries = [...countries].sort(() => 0.5 - Math.random());
            
            // Ensure we don't have more questions than available countries
            const actualQuestions = Math.min(totalQuestions, shuffledCountries.length);
            
            for (let i = 0; i < actualQuestions; i++) {
                const correctCountry = shuffledCountries[i];
                
                // Get wrong options from remaining countries (not used in this game)
                const availableWrongOptions = countries.filter(c => 
                    c.code !== correctCountry.code && 
                    !shuffledCountries.slice(0, actualQuestions).includes(c)
                );
                
                // If we don't have enough unused countries, use any other countries
                let wrongOptions = availableWrongOptions.length >= 2 ? 
                    availableWrongOptions : 
                    countries.filter(c => c.code !== correctCountry.code);
                
                const shuffledWrong = wrongOptions.sort(() => 0.5 - Math.random()).slice(0, 2);
                
                const options = [correctCountry, ...shuffledWrong].sort(() => 0.5 - Math.random());
                const correctIndex = options.findIndex(o => o.code === correctCountry.code);
                
                gameData.push({
                    correctCountry: correctCountry,
                    options: options,
                    correctIndex: correctIndex,
                    answered: false,
                    selectedAnswer: null
                });
            }
            
            // Update total questions to actual number generated
            totalQuestions = actualQuestions;
            
            currentQuestion = 0;
            score = 0;
            correctAnswers = 0;
            selectedAnswer = null;
            correctAnswer = null;
            
            document.getElementById('total-questions').textContent = totalQuestions;
            document.getElementById('total-questions-score').textContent = totalQuestions;
            
            // Show/hide appropriate content based on game mode
            if (gameMode === 'nameFromFlag') {
                document.getElementById('nameFromFlag-content').style.display = 'block';
                document.getElementById('flagFromName-content').style.display = 'none';
                document.getElementById('text-options').style.display = 'flex';
                document.getElementById('flag-options').style.display = 'none';
            } else {
                document.getElementById('nameFromFlag-content').style.display = 'none';
                document.getElementById('flagFromName-content').style.display = 'block';
                document.getElementById('text-options').style.display = 'none';
                document.getElementById('flag-options').style.display = 'grid';
            }
            
            initMap();
            showWorldMap();
            loadQuestion();
        }

        function clearAllButtonStates() {
            // Aggressively clear all visual states from option buttons
            document.querySelectorAll('.option-btn').forEach(btn => {
                // Remove all classes except the base one
                btn.className = 'option-btn';
                
                // Force clear all inline styles and CSS properties
                btn.removeAttribute('style');
                btn.style.background = '#007bff';
                btn.style.transform = 'none';
                btn.style.boxShadow = '0 4px 10px rgba(0, 123, 255, 0.3)';
                
                // Remove focus and active states
                if (btn === document.activeElement) {
                    btn.blur();
                }
                
                // Force the button to lose any pseudo-class states
                btn.style.pointerEvents = 'none';
                setTimeout(() => {
                    btn.style.pointerEvents = 'auto';
                }, 10);
                
                // Force redraw by temporarily hiding and showing
                btn.style.visibility = 'hidden';
                btn.offsetHeight; // Force reflow
                btn.style.visibility = 'visible';
            });
        }

        function clearAllFlagStates() {
            // Aggressively clear all visual states from flag options
            document.querySelectorAll('.flag-option').forEach(option => {
                // Remove all classes except the base one
                option.className = 'flag-option';
                
                // Force clear all inline styles
                option.removeAttribute('style');
                
                // Remove focus
                if (option === document.activeElement) {
                    option.blur();
                }
                
                // Force redraw by temporarily hiding and showing
                option.style.visibility = 'hidden';
                option.offsetHeight; // Force reflow
                option.style.visibility = 'visible';
            });
        }

        function loadQuestion() {
            const questionData = gameData[currentQuestion];
            
            // Clear all states first, especially important for touch devices
            if (gameMode === 'nameFromFlag') {
                clearAllButtonStates();
            } else if (gameMode === 'flagFromName') {
                clearAllFlagStates();
            }
            
            if (gameStyle === 'standard') {
                document.getElementById('question-number').textContent = currentQuestion + 1;
            } else {
                document.getElementById('questions-answered').textContent = questionsAnsweredInTime;
            }
            
            if (gameMode === 'nameFromFlag') {
                // Show flag, choose name
                document.getElementById('flag-image').src = `https://flagcdn.com/w320/${questionData.correctCountry.code}.png`;
                document.getElementById('continent-info').style.display = 'none';
                
                if (questionData.answered) {
                    document.getElementById('continent-info').textContent = questionData.correctCountry.continent;
                    document.getElementById('continent-info').style.display = 'block';
                    showCountryMap(questionData.correctCountry.code, questionData.correctCountry.name);
                } else {
                    showWorldMap();
                }
                
                const optionButtons = document.querySelectorAll('.option-btn');
                optionButtons.forEach((btn, index) => {
                    btn.textContent = questionData.options[index].name;
                    // Reset all classes and remove any focus/active states on touch devices
                    btn.className = 'option-btn';
                    btn.style.background = '#007bff';
                    btn.style.transform = 'none';
                    btn.style.boxShadow = '0 4px 10px rgba(0, 123, 255, 0.3)';
                    btn.blur(); // Remove focus on touch devices
                    
                    // Remove any existing capital info
                    const existingCapital = btn.querySelector('.capital-info');
                    if (existingCapital) {
                        existingCapital.remove();
                    }
                    
                    if (questionData.answered) {
                        const capitalDiv = document.createElement('div');
                        capitalDiv.className = 'capital-info';
                        capitalDiv.textContent = `Capital: ${questionData.options[index].capital}`;
                        btn.appendChild(capitalDiv);
                        
                        if (index === questionData.correctIndex) {
                            btn.classList.add('correct');
                        } else if (index === questionData.selectedAnswer) {
                            btn.classList.add('incorrect');
                        }
                    }
                });
            } else {
                // Show name, choose flag
                document.getElementById('country-label').textContent = questionData.correctCountry.name;
                document.getElementById('capital-label').textContent = `Capital: ${questionData.correctCountry.capital}`;
                
                if (questionData.answered) {
                    showCountryMap(questionData.correctCountry.code, questionData.correctCountry.name);
                } else {
                    showWorldMap();
                }
                
                const flagOptions = document.querySelectorAll('.flag-option');
                flagOptions.forEach((option, index) => {
                    const img = option.querySelector('img');
                    img.src = `https://flagcdn.com/w320/${questionData.options[index].code}.png`;
                    
                    // Reset all classes and remove any focus/active states
                    option.className = 'flag-option';
                    option.style.transform = '';
                    option.style.boxShadow = '';
                    option.style.borderColor = '';
                    option.blur(); // Remove focus on touch devices
                    
                    const flagInfo = option.querySelector('.flag-info');
                    const countryNameDiv = option.querySelector('.flag-country-name');
                    const capitalNameDiv = option.querySelector('.flag-capital-name');
                    
                    if (questionData.answered) {
                        option.classList.add('disabled');
                        
                        // Show country and capital info
                        flagInfo.style.display = 'block';
                        countryNameDiv.textContent = questionData.options[index].name;
                        capitalNameDiv.textContent = `Capital: ${questionData.options[index].capital}`;
                        
                        if (index === questionData.correctIndex) {
                            option.classList.add('correct');
                        } else if (index === questionData.selectedAnswer) {
                            option.classList.add('incorrect');
                        }
                    } else {
                        // Reset to clean state for new question
                        flagInfo.style.display = 'none';
                        countryNameDiv.textContent = '';
                        capitalNameDiv.textContent = '';
                    }
                });
            }
            
            // Navigation buttons behavior differs in timed mode
            if (gameStyle === 'timed') {
                document.getElementById('prev-btn').style.display = 'none';
                document.getElementById('next-btn').disabled = !questionData.answered;
                document.getElementById('next-btn').textContent = 'Next →';
            } else {
                document.getElementById('prev-btn').style.display = 'block';
                document.getElementById('prev-btn').disabled = currentQuestion === 0;
                document.getElementById('next-btn').disabled = !questionData.answered;
                if (currentQuestion === totalQuestions - 1) {
                    document.getElementById('next-btn').textContent = 'Finish';
                } else {
                    document.getElementById('next-btn').textContent = 'Next →';
                }
            }
            
            document.getElementById('score').textContent = correctAnswers;
            
            selectedAnswer = questionData.selectedAnswer;
            correctAnswer = questionData.correctIndex;
        }

        function selectOption(optionIndex) {
            if (gameMode === 'nameFromFlag') {
                // Remove focus from all option buttons to prevent sticky states on touch devices
                document.querySelectorAll('.option-btn').forEach(btn => {
                    btn.blur();
                    btn.style.transform = '';
                    btn.style.boxShadow = '';
                });
                
                handleAnswer(optionIndex);
            }
        }

        function selectFlagOption(optionIndex) {
            if (gameMode === 'flagFromName') {
                // Remove focus from all flag options to prevent sticky hover states on touch devices
                document.querySelectorAll('.flag-option').forEach(option => {
                    option.blur();
                    option.style.transform = '';
                    option.style.boxShadow = '';
                    option.style.borderColor = '';
                });
                
                handleAnswer(optionIndex);
            }
        }

        let autoAdvanceTimeout = null;

        function handleAnswer(optionIndex) {
            const questionData = gameData[currentQuestion];
            if (questionData.answered) return;

            // Clear any existing auto-advance timeout
            if (autoAdvanceTimeout) {
                clearTimeout(autoAdvanceTimeout);
                autoAdvanceTimeout = null;
            }

            questionData.answered = true;
            questionData.selectedAnswer = optionIndex;
            
            if (gameStyle === 'timed') {
                questionsAnsweredInTime++;
                document.getElementById('questions-answered').textContent = questionsAnsweredInTime;
            }

            correctAnswer = questionData.correctIndex;

            showCountryMap(questionData.correctCountry.code, questionData.correctCountry.name);

            if (gameMode === 'nameFromFlag') {
                document.getElementById('continent-info').textContent = questionData.correctCountry.continent;
                document.getElementById('continent-info').style.display = 'block';

                document.querySelectorAll('.option-btn').forEach((btn, idx) => {
                    btn.disabled = true;

                    const existingCapital = btn.querySelector('.capital-info');
                    if (existingCapital) {
                        existingCapital.remove();
                    }

                    const div = document.createElement('div');
                    div.className = 'capital-info';
                    div.textContent = `Capital: ${questionData.options[idx].capital}`;
                    btn.appendChild(div);

                    if (idx === correctAnswer) {
                        btn.classList.add('correct');
                    } else if (idx === optionIndex) {
                        btn.classList.add('incorrect');
                    }
                });
            } else {
                document.querySelectorAll('.flag-option').forEach((option, idx) => {
                    option.classList.add('disabled');
                    
                    // Show country and capital info for all flags
                    const flagInfo = option.querySelector('.flag-info');
                    const countryNameDiv = option.querySelector('.flag-country-name');
                    const capitalNameDiv = option.querySelector('.flag-capital-name');
                    
                    flagInfo.style.display = 'block';
                    countryNameDiv.textContent = questionData.options[idx].name;
                    capitalNameDiv.textContent = `Capital: ${questionData.options[idx].capital}`;

                    if (idx === correctAnswer) {
                        option.classList.add('correct');
                    } else if (idx === optionIndex) {
                        option.classList.add('incorrect');
                    }
                });
            }

            if (optionIndex === correctAnswer) {
                correctAnswers++;
                document.getElementById('score').textContent = correctAnswers;
            }

            document.getElementById('next-btn').disabled = false;
            
            // In timed mode, handle auto-advance based on correctness
            if (gameStyle === 'timed') {
                if (optionIndex === correctAnswer) {
                    // Correct answer - advance immediately
                    autoAdvanceTimeout = setTimeout(() => {
                        if (timeRemaining > 0 && currentQuestion < totalQuestions - 1) {
                            nextQuestion();
                        } else if (timeRemaining > 0) {
                            // No more questions, end game
                            endGame();
                        }
                        autoAdvanceTimeout = null;
                    }, 500); // Very short delay just to see the green highlight
                } else {
                    // Incorrect answer - show feedback longer
                    autoAdvanceTimeout = setTimeout(() => {
                        if (timeRemaining > 0 && currentQuestion < totalQuestions - 1) {
                            nextQuestion();
                        } else if (timeRemaining > 0) {
                            // No more questions, end game
                            endGame();
                        }
                        autoAdvanceTimeout = null;
                    }, 2500); // Longer delay to read the correct answer
                }
            }
        }

        function nextQuestion() {
            // Clear any lingering states before moving to next question
            if (gameMode === 'nameFromFlag') {
                clearAllButtonStates();
            } else if (gameMode === 'flagFromName') {
                clearAllFlagStates();
            }
            
            if (gameStyle === 'standard') {
                if (currentQuestion < totalQuestions - 1) {
                    currentQuestion++;
                    // Small delay to ensure clean state transition on touch devices
                    setTimeout(() => {
                        loadQuestion();
                    }, 50);
                } else {
                    endGame();
                }
            } else {
                // Timed mode
                if (currentQuestion < totalQuestions - 1 && timeRemaining > 0) {
                    currentQuestion++;
                    // Small delay to ensure clean state transition on touch devices
                    setTimeout(() => {
                        loadQuestion();
                    }, 50);
                } else {
                    // No more questions available or time is up
                    endGame();
                }
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function endGame() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('game-over').style.display = 'block';
            
            if (gameStyle === 'timed') {
                document.getElementById('final-score').textContent = correctAnswers;
                document.getElementById('total-score').textContent = questionsAnsweredInTime;
                
                // Update the game over message for timed mode
                const gameOverTitle = document.querySelector('#game-over h2');
                if (timeRemaining <= 0) {
                    gameOverTitle.textContent = "⏱️ Time's Up!";
                } else {
                    gameOverTitle.textContent = "🎉 All Questions Answered!";
                }
            } else {
                document.getElementById('final-score').textContent = correctAnswers;
                document.getElementById('total-score').textContent = totalQuestions;
                document.querySelector('#game-over h2').textContent = "🎉 Game Complete!";
            }
            
            createFlagAnimation();
        }

        // Initialize the game when the page loads
        window.addEventListener('load', function() {
            document.getElementById('setup-area').style.display = 'block';
            document.getElementById('game-area').style.display = 'none';
            document.getElementById('game-over').style.display = 'none';
            
            // Setup the music system
            setupMusicSystem();
            
            // Add touch event handling for better mobile experience
            document.addEventListener('touchend', function() {
                // Remove any lingering hover states on touch devices
                document.querySelectorAll('.flag-option').forEach(option => {
                    if (!option.classList.contains('correct') && !option.classList.contains('incorrect') && !option.classList.contains('disabled')) {
                        option.style.transform = '';
                        option.style.boxShadow = '';
                        option.style.borderColor = '';
                    }
                });
                
                // Also clear option button states
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (!btn.classList.contains('correct') && !btn.classList.contains('incorrect') && !btn.disabled) {
                        btn.style.transform = '';
                        btn.style.boxShadow = '';
                    }
                });
            });
        });
    </script>
</body>
</html>